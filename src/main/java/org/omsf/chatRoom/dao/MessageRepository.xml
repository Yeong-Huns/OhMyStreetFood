<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.omsf.chatRoom.dao.MessageRepository">

    <insert id="save">
        INSERT INTO Message (content, senderId, chatRoomNo)
        VALUES (#{content}, #{senderId}, #{chatRoomNo})
    </insert>


    <select id="findAllByChatRoomNo" resultType="org.omsf.chatRoom.model.MessageWithOwnerResponse">
        SELECT
            m.messageNo,
            m.content,
            m.senderId,
            m.chatRoomNo,
            m.isReceived,
            m.createdAt,
            s.MEMBER_USERNAME AS owner
        FROM
            Message m
                JOIN
            ChatRoom cr ON m.chatRoomNo = cr.chatRoomNo
                JOIN
            Store s ON cr.storeNo = s.STORENO
        WHERE
            m.chatRoomNo = #{chatRoomNo}
    </select>

</mapper>